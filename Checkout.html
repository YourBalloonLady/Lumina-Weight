<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout - LuminaWeight</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body { background: #f8f9fa; font-family: 'Segoe UI', sans-serif; }
  .hero { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: white; padding: 80px 0; }
</style>
</head>
<body>

<div class="hero text-center">
  <div class="container">
    <h1 class="display-4 fw-bold">Checkout</h1>
    <p class="lead">Enter your delivery details below</p>
    <button class="btn btn-outline-light btn-sm" onclick="backToShop()">Back to Shop</button>
  </div>
</div>

<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card shadow">
        <div class="card-body p-5">
          <form id="addressForm">
            <h4 class="mb-4">Delivery Address</h4>
            <div class="row g-3">
              <div class="col-md-6"><input type="text" class="form-control" id="fullName" placeholder="Full Name" required></div>
              <div class="col-md-6"><input type="tel" class="form-control" id="phone" placeholder="Phone Number" required></div>
              <div class="col-12"><input type="text" class="form-control" id="address1" placeholder="Address Line 1" required></div>
              <div class="col-12"><input type="text" class="form-control" id="address2" placeholder="Address Line 2 (optional)"></div>
              <div class="col-md-6"><input type="text" class="form-control" id="city" placeholder="City" required></div>
              <div class="col-md-6"><input type="text" class="form-control" id="postcode" placeholder="Postcode" required></div>
            </div>
            
            <hr class="my-4">
            <h4>Order Summary</h4>
            <div id="order-summary"></div>
            <div class="d-flex justify-content-between fs-4 fw-bold mt-3">
              <span>Total:</span>
              <span id="final-total" class="text-success">£0.00</span>
            </div>
            
            <button type="submit" class="btn btn-success btn-lg w-100 mt-4">
              Confirm Order → Payment Details
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="paymentModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title">Order Confirmed – Payment Details</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="alert alert-success">Thank you <strong id="customerName"></strong>! Your order is confirmed.</div>
        <h5>Your Order</h5>
        <div id="payment-summary" class="mb-4"></div>
        <h4 class="text-success">Total to pay: <span id="payment-total"></span></h4>
        <div class="alert alert-info text-center fs-3 fw-bold p-4" id="payment-amount"></div>
        <hr>
        <p class="fw-bold mb-2">Bank Transfer Details (UK Faster Payments)</p>
        <ul class="list-unstyled">
          <li><strong>Account Name:</strong> LuminaWeight Ltd</li>
          <li><strong>Sort Code:</strong> 12-34-56</li>
          <li><strong>Account Number:</strong> 12345678</li>
          <li><strong>Reference:</strong> <span id="order-ref" class="text-primary fw-bold"></span></li>
        </ul>
        <p>Or message us: <a href="https://wa.me/447123456789" target="_blank">WhatsApp 07123 456789</a></p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-success" onclick="copyAmount()">Copy Amount</button>
        <button type="button" class="btn btn-outline-success" onclick="backToShop()">Back to Shop</button>
      </div>
    </div>
  </div>
</div>

<script>
function getCart() {
  const params = new URLSearchParams(window.location.search);
  const data = params.get('cart');
  if (data) {
    try { return JSON.parse(decodeURIComponent(data)); }
    catch(e) { console.error(e); }
  }
  return [];
}

const cart = getCart();
if (cart.length === 0) {
  alert('Your cart is empty! Taking you back...');
  window.location.href = 'index.html';
}

const total = cart.reduce((s, i) => s + i.price * i.qty, 0);

document.getElementById('order-summary').innerHTML = cart.map(i => `
  <div class="d-flex justify-content-between py-2 border-bottom">
    <span>${i.qty} × ${i.name}</span>
    <span>£${(i.price * i.qty).toFixed(2)}</span>
  </div>
`).join('');
document.getElementById('final-total').textContent = `£${total.toFixed(2)}`;

document.getElementById('addressForm').onsubmit = function(e) {
  e.preventDefault();
  const name = document.getElementById('fullName').value.trim() || 'Customer';
  const ref = 'LW' + Date.now().toString().slice(-6);
  
  document.getElementById('customerName').textContent = name;
  document.getElementById('payment-summary').innerHTML = cart.map(i => `
    <div class="d-flex justify-content-between"><span>${i.qty} × ${i.name}</span><span>£${(i.price*i.qty).toFixed(2)}</span></div>
  `).join('');
  document.getElementById('payment-total').textContent = `£${total.toFixed(2)}`;
  document.getElementById('payment-amount').textContent = `£${total.toFixed(2)}`;
  document.getElementById('order-ref').textContent = ref;
  
  new bootstrap.Modal(document.getElementById('paymentModal')).show();
};

function copyAmount() {
  navigator.clipboard.writeText(document.getElementById('payment-amount').textContent)
    .then(() => alert('Amount copied!'))
    .catch(() => alert('Copy failed – please select and copy manually'));
}

// THIS IS THE KEY FUNCTION – keeps basket when going back
function backToShop() {
  const cartData = encodeURIComponent(JSON.stringify(cart));
  window.location.href = `index.html?cart=${cartData}`;
}
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>